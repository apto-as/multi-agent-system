{
  "audit_type": "compliance",
  "timestamp": "2025-11-18T16:00:00+09:00",
  "auditor": "Hestia (Security Guardian)",
  "image": "tmws:v2.4.0-test",
  "dependency_vulnerabilities": {
    "scan_method": "Trivy (container scan)",
    "critical": [],
    "high": [
      {
        "cve": "CVE-2024-23342",
        "package": "ecdsa==0.19.1",
        "severity": "HIGH",
        "cvss_score": 7.4,
        "description": "Minerva timing attack on ECDSA signature",
        "fixed_version": null,
        "workaround": "Monitor for updates, consider HMAC-only JWT"
      }
    ],
    "medium": [],
    "low": [],
    "total_vulnerable_packages": 1,
    "note": "pip-audit not available in container, relied on Trivy results"
  },
  "license_compliance": {
    "gpl_packages": [],
    "agpl_packages": [],
    "proprietary_packages": [],
    "unknown_license_packages": ["ttl-cache"],
    "compliant": true,
    "violations": [],
    "note": "0 GPL/AGPL violations, 1 unknown license (ttl-cache - investigate)"
  },
  "supply_chain": {
    "all_from_pypi": true,
    "malicious_packages": [],
    "unsigned_packages": "N/A (pip does not verify signatures by default)",
    "total_packages": 168,
    "note": "All packages from PyPI, no custom sources detected"
  },
  "cis_benchmark": {
    "runs_as_root": false,
    "actual_user": "tmws",
    "uid": 1000,
    "privileged_mode": false,
    "read_only_fs_compatible": "Unknown (requires runtime test)",
    "compliance_percentage": "N/A (partial checks only)",
    "note": "Container runs as non-root user 'tmws' (UID 1000), good security practice"
  },
  "pass": false,
  "conditional_pass": true,
  "critical_findings": [],
  "high_findings": [
    {
      "id": "CVE-2024-23342",
      "severity": "HIGH",
      "impact": "Timing attack on JWT crypto library",
      "recommendation": "Monitor ecdsa updates, conditional approval"
    },
    {
      "id": "LICENSE_TEST_REGRESSION",
      "severity": "HIGH",
      "impact": "7/16 license security tests failing due to API changes",
      "recommendation": "Update test suite before production deployment"
    }
  ],
  "medium_findings": [
    {
      "id": "LICENSE_FILE_MISSING",
      "severity": "MEDIUM",
      "impact": "Apache 2.0 compliance incomplete",
      "recommendation": "Add LICENSE file to Docker image"
    },
    {
      "id": "UNKNOWN_LICENSE",
      "severity": "LOW",
      "impact": "ttl-cache package license unknown",
      "recommendation": "Investigate ttl-cache license before production"
    }
  ],
  "recommendation": {
    "decision": "CONDITIONAL APPROVAL",
    "conditions": [
      "Fix license security test suite (7 failing tests)",
      "Add LICENSE file to Docker image",
      "Monitor CVE-2024-23342 for patch availability",
      "Investigate ttl-cache license",
      "Re-run full security audit after fixes"
    ],
    "blocking_issues": 1,
    "non_blocking_issues": 3,
    "approval_level": "GATE_2_CONDITIONAL",
    "notes": "Critical security tests (SQL injection, code injection, tier bypass) all PASS. Failures are due to API signature changes, not security regressions."
  }
}
