# Trinitas Quality Guardian - Pytest Configuration
# Test framework configuration for TDD/BDD practices
# Optimized by Artemis for test quality and coverage

[tool:pytest]
# Test discovery patterns
python_files = test_*.py tests_*.py *_test.py *_tests.py
python_classes = Test* *Tests
python_functions = test_* tests_*

# Test paths
testpaths = tests

# Minimum Python version
minversion = 3.11

# Add current directory to Python path
addopts =
    # Verbosity and output
    -v
    --tb=short
    --strict-markers
    --strict-config

    # Coverage configuration
    --cov=src
    --cov-branch
    --cov-report=term-missing:skip-covered
    --cov-report=html:htmlcov
    --cov-report=xml
    --cov-fail-under=80

    # Quality checks
    --doctest-modules
    --doctest-continue-on-failure

    # Performance
    --durations=10
    --durations-min=0.5

    # Warnings
    -W error::DeprecationWarning
    -W error::PendingDeprecationWarning

    # Parallel execution (if pytest-xdist is installed)
    ; -n auto

    # Output
    --color=yes
    --code-highlight=yes

    # Fail fast (stop after first failure)
    ; -x

    # Show local variables in tracebacks
    -l

    # Capture output
    -s

# Markers for organizing tests
markers =
    # Test categories
    unit: Unit tests (fast, isolated)
    integration: Integration tests (may require external resources)
    e2e: End-to-end tests (full system tests)
    smoke: Smoke tests (basic functionality)
    regression: Regression tests (prevent bugs from reoccurring)

    # Performance markers
    slow: Tests that take > 1 second
    performance: Performance benchmarks

    # Environment markers
    requires_db: Tests requiring database
    requires_network: Tests requiring network access
    requires_docker: Tests requiring Docker

    # Quality markers
    critical: Critical functionality that must never break
    security: Security-related tests

    # Development markers
    wip: Work in progress (skip in CI)
    skip_ci: Skip in CI environment

    # TDD/BDD markers
    given: BDD Given step
    when: BDD When step
    then: BDD Then step

# Console output
console_output_style = progress

# Logging
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] [%(name)s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

log_file = tests/pytest.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] [%(name)s] %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# Timeout for tests (requires pytest-timeout)
timeout = 300
timeout_method = thread

# Ignore warnings from specific modules
filterwarnings =
    ignore::DeprecationWarning:django.*
    ignore::PendingDeprecationWarning
    error::UserWarning:src.*

# Coverage exclusions
[coverage:run]
branch = True
source = src
omit =
    */tests/*
    */test_*.py
    */__pycache__/*
    */migrations/*
    */venv/*
    */.venv/*

[coverage:report]
exclude_lines =
    # Standard pragma
    pragma: no cover

    # Debug-only code
    def __repr__
    if self.debug

    # Defensive programming
    raise AssertionError
    raise NotImplementedError

    # Non-executable code
    if 0:
    if False:
    if __name__ == .__main__.:

    # Type checking
    if TYPE_CHECKING:

    # Abstract methods
    @(abc\.)?abstractmethod

ignore_errors = False
precision = 2
show_missing = True
skip_covered = False
skip_empty = True

[coverage:html]
directory = htmlcov
title = Trinitas Project Coverage Report

[coverage:xml]
output = coverage.xml